<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wiki Kafka Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: #ffffff;
            padding: 20px;
        }

        .dashboard-container {
            max-width: 1600px;
            margin: 0 auto;
        }

        /* Header */
        .header {
            text-align: center;
            padding: 30px 0;
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .header h1 {
            font-size: 2.5rem;
            background: linear-gradient(90deg, #00ff88, #00d4ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .header .subtitle {
            color: #888;
            font-size: 1rem;
        }

        .header-stats {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin-top: 20px;
        }

        .header-stat {
            text-align: center;
        }

        .header-stat .value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #00ff88;
        }

        .header-stat .label {
            font-size: 0.85rem;
            color: #888;
        }

        /* Status Badge */
        .status-badge {
            display: inline-block;
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9rem;
            margin-top: 15px;
        }

        .status-up {
            background: rgba(0, 255, 136, 0.2);
            color: #00ff88;
            border: 1px solid #00ff88;
        }

        .status-down {
            background: rgba(255, 71, 87, 0.2);
            color: #ff4757;
            border: 1px solid #ff4757;
        }

        .status-unknown {
            background: rgba(255, 193, 7, 0.2);
            color: #ffc107;
            border: 1px solid #ffc107;
        }

        /* Grid Layout */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        /* Cards */
        .card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .card-title {
            font-size: 1.2rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-title .icon {
            font-size: 1.5rem;
        }

        /* Service Status Grid */
        .services-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .service-item {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .service-item:hover {
            background: rgba(0, 0, 0, 0.3);
        }

        .service-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-bottom: 8px;
            animation: pulse 2s infinite;
        }

        .indicator-up {
            background: #00ff88;
            box-shadow: 0 0 10px #00ff88;
        }

        .indicator-down {
            background: #ff4757;
            box-shadow: 0 0 10px #ff4757;
            animation: pulse-red 1s infinite;
        }

        .indicator-unknown {
            background: #ffc107;
            box-shadow: 0 0 10px #ffc107;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.1); }
        }

        @keyframes pulse-red {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .service-name {
            font-size: 0.85rem;
            color: #ccc;
            margin-bottom: 5px;
        }

        .service-status {
            font-size: 0.75rem;
            font-weight: bold;
        }

        /* Metrics */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .metric-item {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
        }

        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            color: #00d4ff;
        }

        .metric-label {
            font-size: 0.85rem;
            color: #888;
            margin-top: 5px;
        }

        .metric-trend {
            font-size: 0.75rem;
            margin-top: 5px;
        }

        .trend-up {
            color: #00ff88;
        }

        .trend-down {
            color: #ff4757;
        }

        /* Charts */
        .chart-container {
            position: relative;
            height: 250px;
            margin-top: 15px;
        }

        /* Consumer Lag Bars */
        .lag-bars {
            margin-top: 15px;
        }

        .lag-item {
            margin-bottom: 15px;
        }

        .lag-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 0.85rem;
        }

        .lag-bar-container {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
            height: 8px;
            overflow: hidden;
        }

        .lag-bar {
            height: 100%;
            border-radius: 5px;
            transition: width 0.5s ease;
        }

        .lag-low {
            background: linear-gradient(90deg, #00ff88, #00d4ff);
        }

        .lag-medium {
            background: linear-gradient(90deg, #ffc107, #ff9800);
        }

        .lag-high {
            background: linear-gradient(90deg, #ff4757, #ff6b81);
        }

        /* Quick Links */
        .quick-links {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
        }

        .quick-link {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            text-decoration: none;
            color: #fff;
            transition: all 0.3s ease;
        }

        .quick-link:hover {
            background: rgba(0, 212, 255, 0.2);
            transform: translateY(-3px);
        }

        .quick-link .link-icon {
            font-size: 1.5rem;
            margin-bottom: 8px;
        }

        .quick-link .link-name {
            font-size: 0.8rem;
            text-align: center;
        }

        /* Recent Activity */
        .activity-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .activity-item {
            display: flex;
            align-items: center;
            padding: 12px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            margin-bottom: 10px;
            font-size: 0.85rem;
        }

        .activity-icon {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            font-size: 1rem;
        }

        .activity-edit {
            background: rgba(0, 212, 255, 0.2);
        }

        .activity-create {
            background: rgba(0, 255, 136, 0.2);
        }

        .activity-delete {
            background: rgba(255, 71, 87, 0.2);
        }

        .activity-content {
            flex: 1;
        }

        .activity-title {
            color: #fff;
            margin-bottom: 3px;
        }

        .activity-meta {
            color: #888;
            font-size: 0.75rem;
        }

        .activity-time {
            color: #666;
            font-size: 0.75rem;
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 20px;
            color: #666;
            font-size: 0.85rem;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8rem;
            }
            
            .header-stats {
                flex-wrap: wrap;
                gap: 20px;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .metrics-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(0, 212, 255, 0.5);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 212, 255, 0.7);
        }

        /* Loading Spinner */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #00d4ff;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Full Width Cards */
        .full-width {
            grid-column: 1 / -1;
        }

        /* Alert Banner */
        .alert-banner {
            background: rgba(255, 71, 87, 0.2);
            border: 1px solid #ff4757;
            border-radius: 10px;
            padding: 15px 20px;
            margin-bottom: 20px;
            display: none;
        }

        .alert-banner.active {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .alert-icon {
            font-size: 1.5rem;
        }

        .alert-content {
            flex: 1;
        }

        .alert-title {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .alert-message {
            font-size: 0.85rem;
            color: #ccc;
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <!-- Alert Banner -->
        <div class="alert-banner" id="alert-banner">
            <span class="alert-icon">‚ö†Ô∏è</span>
            <div class="alert-content">
                <div class="alert-title" id="alert-title">System Alert</div>
                <div class="alert-message" id="alert-message">Some services may be experiencing issues.</div>
            </div>
        </div>

        <!-- Header -->
        <div class="header">
            <h1>üöÄ Wiki Kafka Dashboard</h1>
            <p class="subtitle">Real-time Wikipedia Event Stream Monitoring</p>
            <div class="header-stats">
                <div class="header-stat">
                    <div class="value" id="uptime">0m 0s</div>
                    <div class="label">Uptime</div>
                </div>
                <div class="header-stat">
                    <div class="value" id="messages-processed">0</div>
                    <div class="label">Messages Processed</div>
                </div>
                <div class="header-stat">
                    <div class="value" id="events-per-sec">0</div>
                    <div class="label">Events/sec</div>
                </div>
                <div class="header-stat">
                    <div class="value" id="active-topics">4</div>
                    <div class="label">Active Topics</div>
                </div>
            </div>
            <div class="status-badge status-up" id="overall-status">All Systems Go</div>
            <p class="subtitle" id="timestamp" style="margin-top: 15px;">Last updated: --</p>
        </div>

        <!-- Main Dashboard Grid -->
        <div class="dashboard-grid">
            <!-- Infrastructure Services -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <span class="icon">üèóÔ∏è</span>
                        Infrastructure Services
                    </div>
                </div>
                <div class="services-grid">
                    <div class="service-item">
                        <div class="service-indicator indicator-unknown" id="zookeeper-indicator"></div>
                        <div class="service-name">Zookeeper</div>
                        <div class="service-status" id="zookeeper-status">Checking...</div>
                    </div>
                    <div class="service-item">
                        <div class="service-indicator indicator-unknown" id="kafka-indicator"></div>
                        <div class="service-name">Kafka Broker</div>
                        <div class="service-status" id="kafka-status">Checking...</div>
                    </div>
                    <div class="service-item">
                        <div class="service-indicator indicator-unknown" id="schema-registry-indicator"></div>
                        <div class="service-name">Schema Registry</div>
                        <div class="service-status" id="schema-registry-status">Checking...</div>
                    </div>
                    <div class="service-item">
                        <div class="service-indicator indicator-unknown" id="kafka-ui-indicator"></div>
                        <div class="service-name">Kafka UI</div>
                        <div class="service-status" id="kafka-ui-status">Checking...</div>
                    </div>
                </div>
            </div>

            <!-- Application Services -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <span class="icon">‚òï</span>
                        Application Services
                    </div>
                </div>
                <div class="services-grid">
                    <div class="service-item">
                        <div class="service-indicator indicator-unknown" id="ingestion-indicator"></div>
                        <div class="service-name">Ingestion Service</div>
                        <div class="service-status" id="ingestion-status">Checking...</div>
                    </div>
                    <div class="service-item">
                        <div class="service-indicator indicator-unknown" id="stream-processor-indicator"></div>
                        <div class="service-name">Stream Processor</div>
                        <div class="service-status" id="stream-processor-status">Checking...</div>
                    </div>
                    <div class="service-item">
                        <div class="service-indicator indicator-unknown" id="consumer-indicator"></div>
                        <div class="service-name">Consumer Service</div>
                        <div class="service-status" id="consumer-status">Checking...</div>
                    </div>
                </div>
            </div>

            <!-- Monitoring Services -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <span class="icon">üìä</span>
                        Monitoring Services
                    </div>
                </div>
                <div class="services-grid">
                    <div class="service-item">
                        <div class="service-indicator indicator-unknown" id="prometheus-indicator"></div>
                        <div class="service-name">Prometheus</div>
                        <div class="service-status" id="prometheus-status">Checking...</div>
                    </div>
                    <div class="service-item">
                        <div class="service-indicator indicator-unknown" id="grafana-indicator"></div>
                        <div class="service-name">Grafana</div>
                        <div class="service-status" id="grafana-status">Checking...</div>
                    </div>
                    <div class="service-item">
                        <div class="service-indicator indicator-unknown" id="alertmanager-indicator"></div>
                        <div class="service-name">AlertManager</div>
                        <div class="service-status" id="alertmanager-status">Checking...</div>
                    </div>
                </div>
            </div>

            <!-- Kafka Metrics -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <span class="icon">üìà</span>
                        Kafka Metrics
                    </div>
                </div>
                <div class="metrics-grid">
                    <div class="metric-item">
                        <div class="metric-value" id="topics-count">4</div>
                        <div class="metric-label">Topics</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value" id="partitions-count">12</div>
                        <div class="metric-label">Partitions</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value" id="consumer-groups">2</div>
                        <div class="metric-label">Consumer Groups</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value" id="consumer-lag">0</div>
                        <div class="metric-label">Total Lag</div>
                    </div>
                </div>
            </div>

            <!-- Consumer Lag -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <span class="icon">‚è±Ô∏è</span>
                        Consumer Lag by Topic
                    </div>
                </div>
                <div class="lag-bars">
                    <div class="lag-item">
                        <div class="lag-header">
                            <span>wiki_changes</span>
                            <span id="wiki-changes-lag">0</span>
                        </div>
                        <div class="lag-bar-container">
                            <div class="lag-bar lag-low" id="wiki-changes-bar" style="width: 5%;"></div>
                        </div>
                    </div>
                    <div class="lag-item">
                        <div class="lag-header">
                            <span>wiki_aggregates</span>
                            <span id="wiki-aggregates-lag">0</span>
                        </div>
                        <div class="lag-bar-container">
                            <div class="lag-bar lag-low" id="wiki-aggregates-bar" style="width: 5%;"></div>
                        </div>
                    </div>
                    <div class="lag-item">
                        <div class="lag-header">
                            <span>_schemas</span>
                            <span id="schemas-lag">0</span>
                        </div>
                        <div class="lag-bar-container">
                            <div class="lag-bar lag-low" id="schemas-bar" style="width: 2%;"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Links -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <span class="icon">üîó</span>
                        Quick Links
                    </div>
                </div>
                <div class="quick-links">
                    <a href="http://localhost:8080" target="_blank" class="quick-link">
                        <span class="link-icon">üìä</span>
                        <span class="link-name">Kafka UI</span>
                    </a>
                    <a href="http://localhost:9090" target="_blank" class="quick-link">
                        <span class="link-icon">üî•</span>
                        <span class="link-name">Prometheus</span>
                    </a>
                    <a href="http://localhost:3000" target="_blank" class="quick-link">
                        <span class="link-icon">üìà</span>
                        <span class="link-name">Grafana</span>
                    </a>
                    <a href="http://localhost:9093" target="_blank" class="quick-link">
                        <span class="link-icon">üö®</span>
                        <span class="link-name">AlertManager</span>
                    </a>
                    <a href="http://localhost:8081" target="_blank" class="quick-link">
                        <span class="link-icon">üìã</span>
                        <span class="link-name">Schema Registry</span>
                    </a>
                </div>
            </div>

            <!-- Throughput Chart -->
            <div class="card full-width">
                <div class="card-header">
                    <div class="card-title">
                        <span class="icon">üìä</span>
                        Message Throughput (Last 5 Minutes)
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="throughputChart"></canvas>
                </div>
            </div>

            <!-- Consumer Lag Chart -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <span class="icon">üìâ</span>
                        Consumer Lag History
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="lagChart"></canvas>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <span class="icon">üìú</span>
                        Recent Wikipedia Events
                    </div>
                </div>
                <div class="activity-list" id="activity-list">
                    <div class="activity-item">
                        <div class="activity-icon activity-edit">‚úèÔ∏è</div>
                        <div class="activity-content">
                            <div class="activity-title">Waiting for events...</div>
                            <div class="activity-meta">Connect to stream to see live events</div>
                        </div>
                        <div class="activity-time">--</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <p>Wiki Kafka Dashboard v1.0 | Built with ‚ù§Ô∏è | 
                <span id="last-updated">--</span>
            </p>
        </div>
    </div>

    <script>
        // Configuration
        const CONFIG = {
            refreshInterval: 5000, // 5 seconds
            maxDataPoints: 30,
            maxActivityItems: 10
        };

        // State
        let startTime = Date.now();
        let messagesProcessed = 0;
        let lagChart = null;
        let throughputChart = null;
        let serviceStatuses = {};

        // Initialize Charts
        function initCharts() {
            // Lag Chart
            const lagCtx = document.getElementById('lagChart').getContext('2d');
            lagChart = new Chart(lagCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Consumer Lag',
                        data: [],
                        borderColor: '#ff6b81',
                        backgroundColor: 'rgba(255, 107, 129, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            display: true,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#888',
                                maxTicksLimit: 6
                            }
                        },
                        y: {
                            display: true,
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#888'
                            }
                        }
                    }
                }
            });

            // Throughput Chart
            const throughputCtx = document.getElementById('throughputChart').getContext('2d');
            throughputChart = new Chart(throughputCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [
                        {
                            label: 'Messages In',
                            data: [],
                            borderColor: '#00ff88',
                            backgroundColor: 'rgba(0, 255, 136, 0.1)',
                            fill: true,
                            tension: 0.4
                        },
                        {
                            label: 'Messages Out',
                            data: [],
                            borderColor: '#00d4ff',
                            backgroundColor: 'rgba(0, 212, 255, 0.1)',
                            fill: true,
                            tension: 0.4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                color: '#888'
                            }
                        }
                    },
                    scales: {
                        x: {
                            display: true,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#888',
                                maxTicksLimit: 10
                            }
                        },
                        y: {
                            display: true,
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#888'
                            }
                        }
                    }
                }
            });
        }

        // Check service health via HTTP
        async function checkHttpService(url, timeout = 3000) {
            try {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), timeout);
                
                const response = await fetch(url, {
                    signal: controller.signal,
                    mode: 'cors',
                    credentials: 'omit'
                });
                
                clearTimeout(timeoutId);
                return response.ok;
            } catch (e) {
                // Try no-cors mode for CORS-restricted endpoints
                try {
                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => controller.abort(), timeout);
                    
                    await fetch(url, {
                        signal: controller.signal,
                        mode: 'no-cors'
                    });
                    
                    clearTimeout(timeoutId);
                    return true; // Server responded (we just can't read the response)
                } catch (e2) {
                    return false;
                }
            }
        }

        // Update service status UI
        function updateServiceUI(serviceId, isUp) {
            const indicator = document.getElementById(`${serviceId}-indicator`);
            const status = document.getElementById(`${serviceId}-status`);
            
            if (indicator) {
                indicator.className = 'service-indicator ' + 
                    (isUp === null ? 'indicator-unknown' : isUp ? 'indicator-up' : 'indicator-down');
            }
            
            if (status) {
                if (isUp === null) {
                    status.textContent = 'Unknown';
                    status.style.color = '#ffc107';
                } else if (isUp) {
                    status.textContent = '‚úì Running';
                    status.style.color = '#00ff88';
                } else {
                    status.textContent = '‚úó Down';
                    status.style.color = '#ff4757';
                }
            }
            
            serviceStatuses[serviceId] = isUp;
        }

        // Update lag bar visualization
        function updateLagBar(topic, lag) {
            const lagElement = document.getElementById(`${topic}-lag`);
            const barElement = document.getElementById(`${topic}-bar`);
            
            if (lagElement) {
                lagElement.textContent = lag;
            }
            
            if (barElement) {
                // Calculate percentage (max 1000 for visualization)
                const percentage = Math.min((lag / 1000) * 100, 100);
                barElement.style.width = `${Math.max(percentage, 2)}%`;
                
                // Update color based on lag
                barElement.className = 'lag-bar ' + 
                    (lag < 100 ? 'lag-low' : lag < 500 ? 'lag-medium' : 'lag-high');
            }
        }

        // Add activity item
        function addActivityItem(event) {
            const activityList = document.getElementById('activity-list');
            const now = new Date();
            
            const item = document.createElement('div');
            item.className = 'activity-item';
            
            const iconClass = event.type === 'edit' ? 'activity-edit' :
                             event.type === 'new' ? 'activity-create' : 'activity-delete';
            const icon = event.type === 'edit' ? '‚úèÔ∏è' :
                        event.type === 'new' ? 'üìù' : 'üóëÔ∏è';
            
            item.innerHTML = `
                <div class="activity-icon ${iconClass}">${icon}</div>
                <div class="activity-content">
                    <div class="activity-title">${event.title || 'Unknown Page'}</div>
                    <div class="activity-meta">${event.wiki || 'wikipedia'} ‚Ä¢ ${event.user || 'anonymous'}</div>
                </div>
                <div class="activity-time">${now.toLocaleTimeString()}</div>
            `;
            
            activityList.insertBefore(item, activityList.firstChild);
            
            // Keep only last N items
            while (activityList.children.length > CONFIG.maxActivityItems) {
                activityList.removeChild(activityList.lastChild);
            }
        }

        // Check all services
        async function checkAllServices() {
            // Infrastructure Services
            // Zookeeper and Kafka don't have HTTP endpoints, so we infer from Kafka UI
            const kafkaUiUp = await checkHttpService('http://localhost:8080');
            
            // If Kafka UI is up, Zookeeper and Kafka are likely up
            updateServiceUI('zookeeper', kafkaUiUp);
            updateServiceUI('kafka', kafkaUiUp);
            updateServiceUI('kafka-ui', kafkaUiUp);
            
            // Schema Registry
            const schemaRegistryUp = await checkHttpService('http://localhost:8081/subjects');
            updateServiceUI('schema-registry', schemaRegistryUp);
            
            // Monitoring Services
            const prometheusUp = await checkHttpService('http://localhost:9090/-/healthy');
            updateServiceUI('prometheus', prometheusUp);
            
            const grafanaUp = await checkHttpService('http://localhost:3000/api/health');
            updateServiceUI('grafana', grafanaUp);
            
            const alertmanagerUp = await checkHttpService('http://localhost:9093/-/healthy');
            updateServiceUI('alertmanager', alertmanagerUp);
            
            // Application Services
            const ingestionUp = await checkHttpService('http://localhost:8084/actuator/health');
            updateServiceUI('ingestion', ingestionUp);
            
            const streamProcessorUp = await checkHttpService('http://localhost:8082/actuator/health');
            updateServiceUI('stream-processor', streamProcessorUp);
            
            const consumerUp = await checkHttpService('http://localhost:8083/actuator/health');
            updateServiceUI('consumer', consumerUp);
            
            // Update overall status
            const allServices = Object.values(serviceStatuses);
            const upCount = allServices.filter(s => s === true).length;
            const totalCount = allServices.length;
            
            const overallStatus = document.getElementById('overall-status');
            const alertBanner = document.getElementById('alert-banner');
            
            if (upCount === totalCount) {
                overallStatus.className = 'status-badge status-up';
                overallStatus.textContent = 'All Systems Go';
                alertBanner.classList.remove('active');
            } else if (upCount >= totalCount * 0.5) {
                overallStatus.className = 'status-badge status-unknown';
                overallStatus.textContent = `${upCount}/${totalCount} Services Up`;
                alertBanner.classList.add('active');
                document.getElementById('alert-title').textContent = 'Partial Outage';
                document.getElementById('alert-message').textContent = 
                    `${totalCount - upCount} service(s) are currently unavailable.`;
            } else {
                overallStatus.className = 'status-badge status-down';
                overallStatus.textContent = 'System Issues';
                alertBanner.classList.add('active');
                document.getElementById('alert-title').textContent = 'Critical Alert';
                document.getElementById('alert-message').textContent = 
                    'Multiple services are down. Please check the infrastructure.';
            }
        }

        // Fetch Prometheus metrics
        async function fetchPrometheusMetrics() {
            try {
                // Get active targets
                const targetsResponse = await fetch('http://localhost:9090/api/v1/targets');
                const targetsData = await targetsResponse.json();
                
                if (targetsData.status === 'success') {
                    const activeTargets = targetsData.data.activeTargets || [];
                    const upTargets = activeTargets.filter(t => t.health === 'up').length;
                    // Update UI if needed
                }
            } catch (e) {
                console.log('Could not fetch Prometheus metrics:', e.message);
            }
        }

        // Update dashboard
        async function updateDashboard() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString();
            
            // Update timestamp
            document.getElementById('timestamp').textContent = `Last updated: ${now.toLocaleString()}`;
            document.getElementById('last-updated').textContent = timeStr;
            
            // Calculate uptime
            const uptimeMs = Date.now() - startTime;
            const uptimeMin = Math.floor(uptimeMs / 60000);
            const uptimeSec = Math.floor((uptimeMs % 60000) / 1000);
            document.getElementById('uptime').textContent = `${uptimeMin}m ${uptimeSec}s`;
            
            // Check all services
            await checkAllServices();
            
            // Fetch Prometheus metrics
            await fetchPrometheusMetrics();
            
            // Simulate some metrics (replace with real data when available)
            const randomLag = Math.floor(Math.random() * 50);
            const randomRate = Math.floor(50 + Math.random() * 50);
            
            // Update messages processed
            messagesProcessed += randomRate;
            document.getElementById('messages-processed').textContent = 
                messagesProcessed.toLocaleString();
            document.getElementById('events-per-sec').textContent = randomRate;
            
            // Update lag metrics
            document.getElementById('consumer-lag').textContent = randomLag;
            updateLagBar('wiki-changes', randomLag);
            updateLagBar('wiki-aggregates', Math.floor(randomLag * 0.3));
            updateLagBar('schemas', 0);
            
            // Update charts
            if (lagChart && throughputChart) {
                // Add data to lag chart
                lagChart.data.labels.push(timeStr);
                lagChart.data.datasets[0].data.push(randomLag);
                
                if (lagChart.data.labels.length > CONFIG.maxDataPoints) {
                    lagChart.data.labels.shift();
                    lagChart.data.datasets[0].data.shift();
                }
                lagChart.update('none');
                
                // Add data to throughput chart
                throughputChart.data.labels.push(timeStr);
                throughputChart.data.datasets[0].data.push(randomRate);
                throughputChart.data.datasets[1].data.push(Math.floor(randomRate * 0.95));
                
                if (throughputChart.data.labels.length > CONFIG.maxDataPoints) {
                    throughputChart.data.labels.shift();
                    throughputChart.data.datasets[0].data.shift();
                    throughputChart.data.datasets[1].data.shift();
                }
                throughputChart.update('none');
            }
            
            // Add random activity (simulated - replace with real events)
            if (Math.random() > 0.5) {
                const wikis = ['en.wikipedia', 'de.wikipedia', 'fr.wikipedia', 'es.wikipedia'];
                const types = ['edit', 'new', 'edit', 'edit'];
                const titles = [
                    'Machine Learning', 'Climate Change', 'Space Exploration',
                    'Quantum Computing', 'Artificial Intelligence', 'Renewable Energy',
                    'Blockchain Technology', 'Neural Networks', 'Data Science'
                ];
                const users = ['WikiBot', 'Editor123', 'DataKeeper', 'InfoUpdater', 'Anonymous'];
                
                addActivityItem({
                    type: types[Math.floor(Math.random() * types.length)],
                    title: titles[Math.floor(Math.random() * titles.length)],
                    wiki: wikis[Math.floor(Math.random() * wikis.length)],
                    user: users[Math.floor(Math.random() * users.length)]
                });
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            console.log('Wiki Kafka Dashboard initializing...');
            
            // Initialize charts
            initCharts();
            
            // Initial update
            updateDashboard();
            
            // Set up refresh interval
            setInterval(updateDashboard, CONFIG.refreshInterval);
            
            console.log('Dashboard initialized successfully!');
        });
    </script>
</body>
</html>